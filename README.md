# Система управления обращениями граждан

## Партия «Новые Люди» — Чувашская Республика

Современная веб-платформа для приёма и обработки обращений граждан с интеграцией Telegram-бота.

---

## Описание проекта

Система предназначена для автоматизации процесса работы с обращениями граждан в региональном отделении партии «Новые Люди». Платформа обеспечивает:

- **Приём обращений** через веб-форму и Telegram мини-приложение
- **Отслеживание статусов** обращений в реальном времени
- **Автоматические уведомления** при изменении статуса через Telegram
- **Панель модератора** для обработки обращений
- **Административную панель** с аналитикой и статистикой

---

## Основные возможности

### Для граждан
- Подача обращений без регистрации
- Выбор категории из иерархического списка
- Прикрепление файлов (фото, документы, видео)
- Анонимная подача обращений
- Отслеживание статуса через Telegram-бота
- Просмотр истории своих обращений

### Для модераторов
- Просмотр всех обращений с фильтрацией
- Поиск по тексту и автору
- Изменение статусов обращений
- Добавление внутренних комментариев
- Присвоение тегов для классификации

### Для администраторов
- Управление пользователями (модераторами)
- Настройка категорий обращений
- Управление статусами и тегами
- Просмотр статистики и аналитики
- Drag-and-drop сортировка элементов
- Настройка уведомлений для Telegram

---

## Технологический стек

### Backend
| Технология | Назначение |
|------------|-----------|
| **FastAPI** | REST API сервер |
| **SQLAlchemy** | ORM для работы с БД |
| **SQLite / PostgreSQL** | База данных |
| **Pydantic** | Валидация данных |
| **python-jose** | JWT аутентификация |
| **bcrypt** | Хеширование паролей |
| **Uvicorn** | ASGI сервер |

### Frontend
| Технология | Назначение |
|------------|-----------|
| **React 18** | UI фреймворк |
| **TypeScript** | Типизация |
| **Vite** | Сборщик |
| **Tailwind CSS** | Стилизация |
| **Framer Motion** | Анимации |
| **React Router** | Маршрутизация |
| **Axios** | HTTP клиент |
| **Recharts** | Графики статистики |
| **@dnd-kit** | Drag-and-drop |

### Telegram Bot
| Технология | Назначение |
|------------|-----------|
| **Aiogram 3** | Telegram Bot API |
| **aiohttp** | HTTP сервер уведомлений |

---

## Структура проекта

```
├── backend/                 # Backend API
│   ├── app/
│   │   ├── core/           # Конфигурация, БД, безопасность
│   │   ├── models/         # SQLAlchemy модели
│   │   ├── routers/        # API эндпоинты
│   │   ├── schemas/        # Pydantic схемы
│   │   └── services/       # Бизнес-логика
│   ├── uploads/            # Загруженные файлы
│   ├── init_db.py          # Ручная инициализация БД (опционально)
│   └── main.py             # Точка входа (автоинициализация БД)
│
├── frontend/               # Frontend приложение
│   ├── src/
│   │   ├── assets/         # Статические ресурсы
│   │   ├── components/     # React компоненты
│   │   ├── contexts/       # React контексты
│   │   ├── pages/          # Страницы приложения
│   │   ├── services/       # API сервисы
│   │   └── types/          # TypeScript типы
│   └── index.html
│
├── telegram_bot/           # Telegram бот
│   ├── handlers.py         # Обработчики команд
│   ├── keyboards.py        # Клавиатуры
│   ├── database.py         # Подключение к БД
│   ├── notification_service.py  # Уведомления
│   └── main.py             # Точка входа
│
├── docker-compose.yml      # Docker конфигурация
├── start.sh               # Скрипт запуска (Linux/macOS)
├── start.bat              # Скрипт запуска (Windows)
└── README.md              # Документация
```

---

## Автоматическая инициализация базы данных

При запуске backend (`main.py`) автоматически выполняется:

1. **Создание таблиц** — если база данных пуста или не существует
2. **Создание администратора** — `admin` / `admin123`
3. **Создание модератора** — `moderator` / `moderator123`
4. **Создание категорий** — базовый набор категорий обращений
5. **Создание тегов** — публичные и внутренние теги
6. **Создание статусов** — new, in_progress, resolved, rejected

Ручной запуск `init_db.py` не требуется — всё происходит автоматически!

---

## Установка и запуск

### Требования

- Python 3.11+
- Node.js 20+
- (Опционально) PostgreSQL 14+ для production

### Переменные окружения

Создайте файл `.env` в корне проекта:

```env
# База данных (SQLite по умолчанию)
DATABASE_URL=sqlite:///./citizens_appeals.db
# Или для PostgreSQL:
# DATABASE_URL=postgresql://user:password@localhost:5432/appeals_db

# Telegram бот
TELEGRAM_BOT_TOKEN=ваш_токен_бота
WEBAPP_URL=https://ваш-домен.com
TELEGRAM_BOT_URL=http://localhost:3001

# Безопасность (опционально)
SECRET_KEY=ваш-секретный-ключ
NOTIFY_SECRET=секрет-для-уведомлений
```

### Быстрый запуск

#### Linux / macOS

```bash
chmod +x start.sh
./start.sh
```

#### Windows

```cmd
start.bat
```

### Ручная установка

#### 1. Backend

```bash
cd backend

# Установите зависимости
pip install -r requirements.txt

# Запустите сервер (БД создаётся автоматически)
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

#### 2. Frontend

```bash
cd frontend

# Установите зависимости
npm install

# Запустите dev-сервер
npm run dev
```

#### 3. Telegram бот

```bash
cd telegram_bot

# Установите зависимости
pip install -r requirements.txt

# Запустите бота
python main.py
```

---

## Docker

### Быстрый запуск

```bash
# Сборка и запуск
docker-compose up -d --build

# Просмотр логов
docker-compose logs -f
```

### Переменные окружения для Docker

Создайте файл `.env` в корне проекта:

```env
TELEGRAM_BOT_TOKEN=ваш_токен_бота
WEBAPP_URL=http://ваш-домен.com
SECRET_KEY=ваш-секретный-ключ
NOTIFY_SECRET=секрет-для-уведомлений
```

---

## API Документация

После запуска backend API документация доступна по адресам:

- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

### Основные эндпоинты

| Метод | Путь | Описание |
|-------|------|----------|
| POST | `/api/appeals` | Создать обращение |
| GET | `/api/appeals` | Список обращений |
| GET | `/api/appeals/{id}` | Получить обращение |
| PUT | `/api/appeals/{id}` | Обновить обращение |
| GET | `/api/categories` | Список категорий |
| POST | `/api/auth/login` | Авторизация |
| GET | `/api/stats` | Статистика |
| GET | `/api/statuses` | Конфигурация статусов |
| GET | `/api/tags` | Теги |

---

## Деплой

### Replit (рекомендуется)

1. Импортируйте проект в Replit
2. Настройте переменные окружения в секретах
3. База данных SQLite создаётся автоматически
4. Нажмите "Publish" для деплоя

### Docker

```bash
# Сборка образов
docker-compose build

# Запуск
docker-compose up -d
```

### Ручной деплой

1. Настройте reverse proxy (nginx/caddy)
2. Используйте Gunicorn для production:

```bash
gunicorn -w 4 -k uvicorn.workers.UvicornWorker main:app --bind 0.0.0.0:8000
```

3. Соберите frontend:

```bash
cd frontend
npm run build
```

4. Настройте раздачу статики из `frontend/dist`

---

## Telegram бот

### Команды бота

| Команда | Описание |
|---------|----------|
| `/start` | Главное меню |
| `/my_appeals` | Мои обращения |
| `/help` | Справка |
| `/about` | О партии |

### Настройка бота

1. Создайте бота через [@BotFather](https://t.me/BotFather)
2. Получите токен бота
3. Настройте Web App:
   ```
   /setmenubutton
   Выберите бота
   Отправьте URL мини-приложения
   ```

---

## Учётные данные по умолчанию

После запуска backend автоматически создаются тестовые аккаунты:

| Роль | Логин | Пароль |
|------|-------|--------|
| Администратор | `admin` | `admin123` |
| Модератор | `moderator` | `moderator123` |

**Важно:** Смените пароли в production!

---

## Разработка

### Структура статусов обращений

| Статус | Описание |
|--------|----------|
| `new` | Новое обращение |
| `in_progress` | В работе |
| `resolved` | Решено |
| `rejected` | Отклонено |

Статусы можно настраивать через админ-панель.

### Типы файлов

Поддерживаются: изображения, документы (PDF, DOC, XLS), архивы, аудио и видео.

---

## Порты по умолчанию

| Сервис | Порт | Описание |
|--------|------|----------|
| Frontend | 5000 | Vite dev server / Nginx (Docker) |
| Backend | 8000 | FastAPI сервер |
| Telegram Bot | 3001 | HTTP сервер уведомлений |

---

## Лицензия

Proprietary. Все права защищены.

---

## Контакты

**Партия «Новые Люди»**  
Чувашское региональное отделение

- Сайт: [novielyudi.ru](https://novielyudi.ru)
- Telegram: [@novielyudi](https://t.me/novielyudi)
